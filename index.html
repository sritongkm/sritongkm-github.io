<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ตรวจสอบวันที่รับสินค้า</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background-color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      padding: 24px;
    }
    h1 {
      text-align: center;
      margin-top: 0;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    label {
      font-weight: bold;
    }
    input[type="text"] {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #result {
      margin-top: 20px;
      padding: 12px;
      background-color: #f0f8ff;
      border: 1px solid #b0c4de;
      border-radius: 4px;
    }
    .hidden {
      display: none;
    }

    /* Styles for tab navigation */
    .tab-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 8px;
    }
    .tab-button {
      padding: 10px 20px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .tab-button.active {
      background-color: #007bff;
      color: #fff;
      border-color: #007bff;
    }

    /* Calendar styles */
    #calendar-section {
      display: none; /* hide by default; toggled via JS */
    }
    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .calendar-nav button {
      padding: 6px 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .calendar-nav button:hover {
      background-color: #0056b3;
    }
    .calendar-table {
      width: 100%;
      border-collapse: collapse;
    }
    .calendar-table th,
    .calendar-table td {
      border: 1px solid #ccc;
      width: 14.28%;
      height: 80px;
      vertical-align: top;
      padding: 4px;
    }
    .calendar-table th {
      background-color: #f0f0f0;
    }
    .calendar-event {
      display: block;
      margin: 2px 0;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 12px;
      cursor: pointer;
      color: #007bff;
      text-decoration: underline;
      background-color: transparent;
    }
    .calendar-day-number {
      font-weight: bold;
    }

    /* Custom autocomplete styles for suggestions list */
    .autocomplete {
      position: relative;
    }
    .autocomplete-items {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      border: 1px solid #ccc;
      border-top: none;
      background-color: #fff;
      max-height: 180px;
      overflow-y: auto;
      z-index: 1000;
      border-radius: 0 0 4px 4px;
    }
    .autocomplete-item {
      padding: 8px;
      cursor: pointer;
    }
    .autocomplete-item:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ตรวจสอบวันที่รับสินค้า</h1>
    <!-- Tab navigation -->
    <div class="tab-container">
      <button class="tab-button active" id="search-tab">ค้นหา</button>
      <button class="tab-button" id="calendar-tab">ปฏิทิน</button>
    </div>

    <!-- Search section -->
    <div id="search-section">
      <p style="text-align:center;">กรุณากรอกข้อมูลสินค้าของคุณเพื่อค้นหาวันที่รับสินค้า</p>
      <form id="search-form" onsubmit="return false;">
        <label for="product-code">รหัสสินค้า</label>
        <!-- Use custom autocomplete container instead of datalist -->
        <div class="autocomplete">
          <input type="text" id="product-code" placeholder="เช่น CAS-100104" autocomplete="off" />
          <div class="autocomplete-items" id="product-code-suggestions"></div>
        </div>

        <label for="product-name">ชื่อสินค้า</label>
        <!-- Use custom autocomplete container instead of datalist -->
        <div class="autocomplete">
          <input type="text" id="product-name" placeholder="เช่น Ring 6 MM" autocomplete="off" />
          <div class="autocomplete-items" id="product-name-suggestions"></div>
        </div>

        <label for="document-code">รหัสเอกสารสั่งซื้อ</label>
        <input type="text" id="document-code" placeholder="เช่น PO-987" />

        <button type="button" onclick="searchProduct()">ค้นหา</button>
      </form>
      <!-- Container to display search results -->
      <div id="result" class="hidden"></div>
    </div>

    <!-- Calendar section -->
    <div id="calendar-section">
      <div class="calendar-nav">
        <button id="prev-month">ก่อนหน้า</button>
        <div id="month-year-title"></div>
        <button id="next-month">ถัดไป</button>
      </div>
      <table class="calendar-table">
        <thead>
          <tr>
            <th>อา</th>
            <th>จ</th>
            <th>อ</th>
            <th>พ</th>
            <th>พฤ</th>
            <th>ศ</th>
            <th>ส</th>
          </tr>
        </thead>
        <tbody id="calendar-body"></tbody>
      </table>
      <!-- Details of events on selected date -->
      <div id="events-list" style="margin-top: 20px;"></div>
    </div>
  </div>

  <script>
    // ข้อมูลจาก Google Sheet "สินค้าค้างรับ" (ตัวอย่าง)
    const sheetData = [
      { productCode: 'CAS-100104', productName: 'Ring 6 MM # 100104 (L)', receiveDate: '2568-12-12 00:00:00', documentCode: 'POS-1234' },
      { productCode: 'CAS-100105', productName: 'Ring 8 MM # 100105 (L)', receiveDate: '2568-12-13 00:00:00', documentCode: 'POS-1235' },
      { productCode: 'CAS-100207', productName: 'Nut 12 MM # 100207 (L)', receiveDate: '2568-12-14 00:00:00', documentCode: 'POS-1236' },
      { productCode: 'CAS-101807', productName: 'Straight Connector 12-3/8 NPT # 101807 (L)', receiveDate: '2568-12-15 00:00:00', documentCode: 'POS-1237' },
      { productCode: 'CAS-101824', productName: 'Straight Connector 6-1/4 NPT # 101824 (L)', receiveDate: '2568-12-16 00:00:00', documentCode: 'POS-1238' },
      { productCode: 'CAS-101832', productName: 'Straight Connector 12-1/2 NPT # 101832 (L)', receiveDate: '2568-12-17 00:00:00', documentCode: 'POS-1239' },
      { productCode: 'CAS-103505', productName: 'Union 8 MM #103505 ( L )', receiveDate: '2568-12-18 00:00:00', documentCode: 'POS-1240' },
      { productCode: 'CAS-103520', productName: 'Union 20 MM # 103520 ( S )', receiveDate: '2568-12-19 00:00:00', documentCode: 'POS-1241' },
      { productCode: 'CAS-103805', productName: 'Union Elbow 8 MM # 103805 ( L )', receiveDate: '2568-12-20 00:00:00', documentCode: 'POS-1242' },
      { productCode: 'CAS-103806', productName: 'Union Elbow 10 MM # 103806 ( L )', receiveDate: '2568-12-21 00:00:00', documentCode: 'POS-1243' },
      { productCode: 'CAS-104111', productName: 'REDUCER FITTING 15L/12L #104111', receiveDate: '2568-12-22 00:00:00', documentCode: 'POS-1244' },
      { productCode: 'CAS-604208', productName: 'ADJ MALE STUD ELBOW 15L #604208', receiveDate: '2568-12-23 00:00:00', documentCode: 'POS-1245' },
      { productCode: 'CAS-605008', productName: 'ADJ EQUAL TEE 15L #605008', receiveDate: '2568-12-24 00:00:00', documentCode: 'POS-1246' }
    ];

    // ค้นหารายการสินค้า
    function searchProduct() {
      const code = document.getElementById('product-code').value.trim();
      const name = document.getElementById('product-name').value.trim();
      const doc = document.getElementById('document-code').value.trim();

      const result = sheetData.find((item) => {
        const matchCode = code ? item.productCode.toLowerCase() === code.toLowerCase() : true;
        const matchName = name ? item.productName.toLowerCase().includes(name.toLowerCase()) : true;
        const matchDoc = doc ? item.documentCode.toLowerCase() === doc.toLowerCase() : true;
        return matchCode && matchName && matchDoc;
      });

      const resultDiv = document.getElementById('result');
      if (result) {
        resultDiv.innerHTML = `
          <h2>พบรายการสินค้า</h2>
          <p><strong>รหัสสินค้า:</strong> ${result.productCode}</p>
          <p><strong>ชื่อสินค้า:</strong> ${result.productName}</p>
          <p><strong>รหัสเอกสารสั่งซื้อ:</strong> ${result.documentCode}</p>
          <p><strong>วันที่รับสินค้า:</strong> ${formatBuddhistDate(result.receiveDate)}</p>
        `;
        resultDiv.classList.remove('hidden');
      } else {
        resultDiv.innerHTML = '<p>ไม่พบข้อมูลตามที่ค้นหา กรุณาลองใหม่อีกครั้ง</p>';
        resultDiv.classList.remove('hidden');
      }
    }

    // แปลงวันที่ พ.ศ. เป็น ค.ศ.
    function formatBuddhistDate(dateString) {
      const parts = dateString.split(' ')[0].split('-');
      let year = parseInt(parts[0], 10);
      const month = parts[1];
      const day = parts[2];
      year = year - 543;
      return `${day}/${month}/${year}`;
    }

    // ระบบแนะนำอัตโนมัติสำหรับช่องรหัสและชื่อสินค้า
    window.addEventListener('DOMContentLoaded', () => {
      const uniqueCodes = [...new Set(sheetData.map(item => item.productCode))];
      const uniqueNames = [...new Set(sheetData.map(item => item.productName))];

      function showSuggestions(inputElem, listElem, listData) {
        const value = inputElem.value.trim().toLowerCase();
        listElem.innerHTML = '';
        if (!value) {
          listElem.style.display = 'none';
          return;
        }
        const matches = listData.filter(item => item.toLowerCase().includes(value));
        matches.forEach(item => {
          const div = document.createElement('div');
          div.textContent = item;
          div.className = 'autocomplete-item';
          div.addEventListener('click', () => {
            inputElem.value = item;
            listElem.innerHTML = '';
            listElem.style.display = 'none';
          });
          listElem.appendChild(div);
        });
        listElem.style.display = matches.length > 0 ? 'block' : 'none';
      }

      const codeInput = document.getElementById('product-code');
      const nameInput = document.getElementById('product-name');
      const codeSuggestions = document.getElementById('product-code-suggestions');
      const nameSuggestions = document.getElementById('product-name-suggestions');
      codeInput.addEventListener('input', () => showSuggestions(codeInput, codeSuggestions, uniqueCodes));
      nameInput.addEventListener('input', () => showSuggestions(nameInput, nameSuggestions, uniqueNames));

      document.addEventListener('click', (e) => {
        if (!e.target.closest('.autocomplete')) {
          codeSuggestions.innerHTML = '';
          codeSuggestions.style.display = 'none';
          nameSuggestions.innerHTML = '';
          nameSuggestions.style.display = 'none';
        }
      });
    });

    // ฟังก์ชันสำหรับแปลงรูปแบบวันที่ (YYYY-MM-DD → DD/MM/YYYY)
    function formatDate(dateString) {
      const [year, month, day] = dateString.split('-');
      return `${day}/${month}/${year}`;
    }

    /*** ส่วนด้านปฏิทิน ***/

    // สร้างแผนที่วัน-รายการสินค้า
    function buildEventsMap(data) {
      const events = {};
      data.forEach(item => {
        const datePart = item.receiveDate.split(' ')[0];
        const [bYear, month, day] = datePart.split('-');
        const gYear = parseInt(bYear, 10) - 543;
        const key = `${gYear}-${month}-${day}`;
        if (!events[key]) events[key] = [];
        events[key].push(item);
      });
      return events;
    }

    const thaiMonths = ['มกราคม','กุมภาพันธ์','มีนาคม','เมษายน','พฤษภาคม','มิถุนายน','กรกฎาคม','สิงหาคม','กันยายน','ตุลาคม','พฤศจิกายน','ธันวาคม'];

    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    const eventsMap = buildEventsMap(sheetData);

    function renderCalendar() {
      const calendarBody = document.getElementById('calendar-body');
      calendarBody.innerHTML = '';
      const firstDay = new Date(currentYear, currentMonth, 1);
      const startingDay = firstDay.getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      const monthYearTitle = document.getElementById('month-year-title');
      const buddhistYear = currentYear + 543;
      monthYearTitle.textContent = `${thaiMonths[currentMonth]} ${buddhistYear}`;

      let date = 1;
      for (let i = 0; i < 6; i++) {
        const row = document.createElement('tr');
        for (let j = 0; j < 7; j++) {
          const cell = document.createElement('td');
          if (i === 0 && j < startingDay) {
            cell.textContent = '';
          } else if (date > daysInMonth) {
            cell.textContent = '';
          } else {
            const dayNumber = document.createElement('div');
            dayNumber.className = 'calendar-day-number';
            dayNumber.textContent = date;
            cell.appendChild(dayNumber);

            const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
            if (eventsMap[dateKey]) {
              eventsMap[dateKey].forEach(evt => {
                const eventElem = document.createElement('a');
                eventElem.className = 'calendar-event';
                eventElem.href = '#';
                eventElem.textContent = evt.productCode;
                eventElem.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  showEventDetails(dateKey);
                });
                cell.appendChild(eventElem);
              });
            }
            cell.addEventListener('click', () => {
              showEventDetails(dateKey);
            });
            date++;
          }
          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
        if (date > daysInMonth) break;
      }
    }

    function showEventDetails(dateKey) {
      const eventsList = document.getElementById('events-list');
      eventsList.innerHTML = '';
      if (eventsMap[dateKey]) {
        const [year, month, day] = dateKey.split('-');
        const buddhistYear = parseInt(year, 10) + 543;
        const heading = document.createElement('h3');
        heading.textContent = `รายการรับสินค้าวันที่ ${parseInt(day, 10)}/${month}/${buddhistYear}`;
        eventsList.appendChild(heading);
        const list = document.createElement('ul');
        eventsMap[dateKey].forEach(evt => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>รหัสสินค้า:</strong> ${evt.productCode} <br> <strong>ชื่อสินค้า:</strong> ${evt.productName} <br> <strong>เลขที่เอกสาร:</strong> ${evt.documentCode}`;
          list.appendChild(li);
        });
        eventsList.appendChild(list);
      } else {
        eventsList.textContent = 'ไม่มีข้อมูลสินค้าที่รับในวันนี้';
      }
    }

    function prevMonth() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    }

    function nextMonth() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }

    // ตั้งค่าแท็บและปุ่มเลื่อนเดือน
    window.addEventListener('DOMContentLoaded', () => {
      const searchTab = document.getElementById('search-tab');
      const calendarTab = document.getElementById('calendar-tab');
      const searchSection = document.getElementById('search-section');
      const calendarSection = document.getElementById('calendar-section');
      searchTab.addEventListener('click', () => {
        searchTab.classList.add('active');
        calendarTab.classList.remove('active');
        searchSection.style.display = 'block';
        calendarSection.style.display = 'none';
      });
      calendarTab.addEventListener('click', () => {
        calendarTab.classList.add('active');
        searchTab.classList.remove('active');
        searchSection.style.display = 'none';
        calendarSection.style.display = 'block';
        renderCalendar();
      });
      document.getElementById('prev-month').addEventListener('click', prevMonth);
      document.getElementById('next-month').addEventListener('click', nextMonth);
    });
  </script>
</body>
</html>
