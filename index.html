<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ตรวจสอบวันที่รับสินค้า</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f4f8; /* light grey-blue background */
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background-color: #ffffff;
      /* subtle border and shadow for card effect */
      border: 1px solid #e3e6eb;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border-radius: 12px;
      padding: 24px 32px;
    }
    h1 {
      text-align: center;
      margin-top: 0;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    label {
      font-weight: bold;
    }
    input[type="text"] {
      padding: 8px;
      border: 1px solid #d0d7e4;
      border-radius: 6px;
      font-size: 16px;
      background-color: #f9fbfd;
      transition: border-color 0.2s, background-color 0.2s;
    }
    input[type="text"]:focus {
      outline: none;
      border-color: #007bff;
      background-color: #ffffff;
    }
    button {
      padding: 10px;
      background-color: #007bff;
      color: #ffffff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #0056b3;
    }
    #result {
      margin-top: 20px;
      padding: 12px;
      background-color: #f0f8ff;
      border: 1px solid #b0c4de;
      border-radius: 4px;
    }
    .hidden {
      display: none;
    }

    /* Styles for tab navigation */
    .tab-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 8px;
    }
    .tab-button {
      padding: 10px 24px;
      background-color: #e9f1f7;
      border: 1px solid #d0d7e4;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      color: #0d6efd;
      transition: background-color 0.2s, color 0.2s;
    }
    .tab-button:hover {
      background-color: #dfe9f1;
    }
    .tab-button.active {
      background-color: #007bff;
      color: #ffffff;
      border-color: #007bff;
    }

    /* Main tab styles for primary pages */
    .main-tab-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 8px;
    }
    .main-tab-button {
      padding: 10px 24px;
      background-color: #e9f1f7;
      border: 1px solid #d0d7e4;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      color: #0d6efd;
      transition: background-color 0.2s, color 0.2s;
    }
    .main-tab-button:hover {
      background-color: #dfe9f1;
    }
    .main-tab-button.active {
      background-color: #007bff;
      color: #ffffff;
      border-color: #007bff;
    }

    /* Calendar styles */
    #calendar-section {
      display: none; /* hide by default; toggled via JS */
    }
    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .calendar-nav button {
      padding: 6px 14px;
      background-color: #007bff;
      color: #ffffff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .calendar-nav button:hover {
      background-color: #0056b3;
    }
    .calendar-table {
      width: 100%;
      border-collapse: collapse;
    }
    .calendar-table th,
    .calendar-table td {
      border: 1px solid #ccc;
      width: 14.28%;
      height: 80px;
      vertical-align: top;
      padding: 4px;
    }
    .calendar-table th {
      background-color: #e9f1f7;
    }
    .calendar-event {
      display: block;
      margin: 2px 0;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      color: #0056b3;
      text-decoration: underline;
      background-color: transparent;
      transition: background-color 0.2s;
    }
    .calendar-event:hover {
      background-color: #e2eaf4;
    }
    .calendar-day-number {
      font-weight: bold;
    }

    /* Custom autocomplete styles for suggestions list */
    .autocomplete {
      position: relative;
    }
    .autocomplete-items {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      border: 1px solid #d0d7e4;
      border-top: none;
      background-color: #ffffff;
      max-height: 180px;
      overflow-y: auto;
      z-index: 1000;
      border-radius: 0 0 6px 6px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    .autocomplete-item {
      padding: 8px;
      cursor: pointer;
    }
    .autocomplete-item:hover {
      background-color: #f1f5fb;
    }

    /* Table for search results */
    .result-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .result-table th,
    .result-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .result-table th {
      background-color: #e9f1f7;
    }

    /* Layout for paired fields */
    .flex-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .flex-row .flex-item {
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Updated heading to reflect Sritong Stock branding -->
    <h1>Sritong Stock</h1>
    <!-- Main tab navigation for primary pages -->
    <div class="main-tab-container">
      <button class="main-tab-button active" id="main-search-tab">ค้นหาวันที่รับสินค้า</button>
      <button class="main-tab-button" id="main-order-tab">จุดสั่งซื้อ</button>
    </div>
    <!-- Search and calendar sub-tabs container -->
    <div id="search-calendar-container">
      <!-- Tab navigation -->
      <div class="tab-container">
        <button class="tab-button active" id="search-tab">ค้นหา</button>
        <button class="tab-button" id="calendar-tab">ปฏิทิน</button>
      </div>

      <!-- Search section -->
      <div id="search-section">
        <p style="text-align:center;">กรุณากรอกข้อมูลสินค้าของคุณเพื่อค้นหาวันที่รับสินค้า</p>
        <form id="search-form" onsubmit="return false;">
          <!-- Row 1: product code range -->
          <div class="flex-row">
            <div class="flex-item">
              <label for="start-code">จากรหัสสินค้า</label>
              <div class="autocomplete">
                <input type="text" id="start-code" placeholder="เช่น CAS-100104" autocomplete="off" />
                <div class="autocomplete-items" id="start-code-suggestions"></div>
              </div>
            </div>
            <div class="flex-item">
              <label for="end-code">ถึงรหัสสินค้า</label>
              <div class="autocomplete">
                <input type="text" id="end-code" placeholder="เช่น CAS-100105" autocomplete="off" />
                <div class="autocomplete-items" id="end-code-suggestions"></div>
              </div>
            </div>
          </div>
          <!-- Row 2: product name range -->
          <div class="flex-row">
            <div class="flex-item">
              <label for="start-name">จากชื่อสินค้า</label>
              <div class="autocomplete">
                <input type="text" id="start-name" placeholder="เช่น Union" autocomplete="off" />
                <div class="autocomplete-items" id="start-name-suggestions"></div>
              </div>
            </div>
            <div class="flex-item">
              <label for="end-name">ถึงชื่อสินค้า</label>
              <div class="autocomplete">
                <input type="text" id="end-name" placeholder="เช่น Ring" autocomplete="off" />
                <div class="autocomplete-items" id="end-name-suggestions"></div>
              </div>
            </div>
          </div>

          <!-- Document code search with suggestions -->
          <label for="document-code">รหัสเอกสารสั่งซื้อ (ตัวเลือก)</label>
          <div class="autocomplete">
            <input type="text" id="document-code" placeholder="เช่น PO-987" autocomplete="off" />
            <div class="autocomplete-items" id="document-code-suggestions"></div>
          </div>

          <button type="button" onclick="searchProduct()">ค้นหา</button>
        </form>
        <!-- Container to display search results -->
        <div id="result" class="hidden"></div>
      </div>

      <!-- Calendar section -->
      <div id="calendar-section">
        <div class="calendar-nav">
          <button id="prev-month">ก่อนหน้า</button>
          <div id="month-year-title"></div>
          <button id="next-month">ถัดไป</button>
        </div>
        <table class="calendar-table">
          <thead>
            <tr>
              <th>อา</th>
              <th>จ</th>
              <th>อ</th>
              <th>พ</th>
              <th>พฤ</th>
              <th>ศ</th>
              <th>ส</th>
            </tr>
          </thead>
          <tbody id="calendar-body"></tbody>
        </table>
        <!-- Details of events on selected date -->
        <div id="events-list" style="margin-top: 20px;"></div>
      </div>
    </div>

    <!-- Reorder section (order point recommendations) -->
    <div id="order-section" class="hidden">
      <h2>รายการสินค้าที่ควรสั่งซื้อ</h2>
      <div id="order-result"></div>
    </div>
  </div>

  <script>
    // Sample data from Google Sheet "สินค้าค้างรับ"
    const sheetData = [
      { productCode: 'CAS-100104', productName: 'Ring 6 MM # 100104 (L)', receiveDate: '2568-12-12 00:00:00', documentCode: 'POS-1234', quantity: 1 },
      { productCode: 'CAS-100105', productName: 'Ring 8 MM # 100105 (L)', receiveDate: '2568-12-13 00:00:00', documentCode: 'POS-1235', quantity: 2 },
      { productCode: 'CAS-100207', productName: 'Nut 12 MM # 100207 (L)', receiveDate: '2568-12-14 00:00:00', documentCode: 'POS-1236', quantity: 3 },
      { productCode: 'CAS-101807', productName: 'Straight Connector 12-3/8 NPT # 101807 (L)', receiveDate: '2568-12-15 00:00:00', documentCode: 'POS-1237', quantity: 4 },
      { productCode: 'CAS-101824', productName: 'Straight Connector 6-1/4 NPT # 101824 (L)', receiveDate: '2568-12-16 00:00:00', documentCode: 'POS-1238', quantity: 5 },
      { productCode: 'CAS-101832', productName: 'Straight Connector 12-1/2 NPT # 101832 (L)', receiveDate: '2568-12-17 00:00:00', documentCode: 'POS-1239', quantity: 6 },
      { productCode: 'CAS-103505', productName: 'Union 8 MM #103505 ( L )', receiveDate: '2568-12-18 00:00:00', documentCode: 'POS-1240', quantity: 7 },
      { productCode: 'CAS-103520', productName: 'Union 20 MM # 103520 ( S )', receiveDate: '2568-12-19 00:00:00', documentCode: 'POS-1241', quantity: 8 },
      { productCode: 'CAS-103805', productName: 'Union Elbow 8 MM # 103805 ( L )', receiveDate: '2568-12-20 00:00:00', documentCode: 'POS-1242', quantity: 9 },
      { productCode: 'CAS-103806', productName: 'Union Elbow 10 MM # 103806 ( L )', receiveDate: '2568-12-21 00:00:00', documentCode: 'POS-1243', quantity: 10 },
      { productCode: 'CAS-104111', productName: 'REDUCER FITTING 15L/12L #104111', receiveDate: '2568-12-22 00:00:00', documentCode: 'POS-1244', quantity: 11 },
      { productCode: 'CAS-604208', productName: 'ADJ MALE STUD ELBOW 15L #604208', receiveDate: '2568-12-23 00:00:00', documentCode: 'POS-1245', quantity: 12 },
      { productCode: 'CAS-605008', productName: 'ADJ EQUAL TEE 15L #605008', receiveDate: '2568-12-24 00:00:00', documentCode: 'POS-1246', quantity: 13 }
    ];

    // Search function
    function searchProduct() {
      const startCode = document.getElementById('start-code').value.trim();
      const endCode = document.getElementById('end-code').value.trim();
      const startName = document.getElementById('start-name').value.trim().toLowerCase();
      const endName = document.getElementById('end-name').value.trim().toLowerCase();
      const doc = document.getElementById('document-code').value.trim().toLowerCase();

      let results = [];

      function extractNumber(code) {
        if (!code) return NaN;
        const parts = code.split('-');
        if (parts.length > 1) {
          return parseInt(parts[1], 10);
        }
        return NaN;
      }

      const startNum = extractNumber(startCode);
      const endNum = extractNumber(endCode);

      if (startCode && endCode && !isNaN(startNum) && !isNaN(endNum)) {
        const s = Math.min(startNum, endNum);
        const e = Math.max(startNum, endNum);
        results = sheetData.filter(item => {
          const codeNum = extractNumber(item.productCode);
          return codeNum >= s && codeNum <= e;
        });
      } else if ((startCode || endCode)) {
        const target = (startCode || endCode).toLowerCase();
        results = sheetData.filter(item => item.productCode.toLowerCase() === target);
      } else {
        results = [...sheetData];
      }

      // Name filter
      if (startName && endName) {
        const sName = startName < endName ? startName : endName;
        const eName = startName < endName ? endName : startName;
        results = results.filter(item => {
          const itemName = item.productName.toLowerCase();
          return itemName >= sName && itemName <= eName;
        });
      } else if (startName || endName) {
        const targetName = startName || endName;
        results = results.filter(item => item.productName.toLowerCase().includes(targetName));
      }
      // Document code filter
      if (doc) {
        results = results.filter(item => item.documentCode.toLowerCase().includes(doc));
      }

      results.sort((a, b) => extractNumber(a.productCode) - extractNumber(b.productCode));

      const resultDiv = document.getElementById('result');
      if (results.length > 0) {
        let html = `<h2>พบ ${results.length} รายการ</h2>`;
        html += `<table class="result-table"><thead><tr><th>#</th><th>รหัสสินค้า</th><th>ชื่อสินค้า</th><th>จำนวน</th><th>เลขที่เอกสาร</th><th>วันที่รับสินค้า</th></tr></thead><tbody>`;
        results.forEach((item, idx) => {
          html += `<tr>` +
                  `<td>${idx + 1}</td>` +
                  `<td>${item.productCode}</td>` +
                  `<td>${item.productName}</td>` +
                  `<td>${item.quantity}</td>` +
                  `<td>${item.documentCode}</td>` +
                  `<td>${formatBuddhistDate(item.receiveDate)}</td>` +
                  `</tr>`;
        });
        html += '</tbody></table>';
        resultDiv.innerHTML = html;
        resultDiv.classList.remove('hidden');
      } else {
        resultDiv.innerHTML = '<p>ไม่พบข้อมูลตามที่ค้นหา กรุณาลองใหม่อีกครั้ง</p>';
        resultDiv.classList.remove('hidden');
      }
    }

    function formatBuddhistDate(dateString) {
      const parts = dateString.split(' ')[0].split('-');
      let year = parseInt(parts[0], 10);
      const month = parts[1];
      const day = parts[2];
      year = year - 543;
      return `${day}/${month}/${year}`;
    }

    // Setup autocomplete suggestions
    window.addEventListener('DOMContentLoaded', () => {
      const uniqueCodes = [...new Set(sheetData.map(item => item.productCode))];
      const uniqueNames = [...new Set(sheetData.map(item => item.productName))];
      const uniqueDocs = [...new Set(sheetData.map(item => item.documentCode))];

      function showSuggestions(inputElem, listElem, listData, showAll = false) {
        const value = inputElem.value.trim().toLowerCase();
        listElem.innerHTML = '';
        let matches = [];
        if (!value && !showAll) {
          listElem.style.display = 'none';
          return;
        }
        if (showAll && !value) {
          matches = listData;
        } else {
          matches = listData.filter(item => item.toLowerCase().includes(value));
        }
        matches.forEach(item => {
          const div = document.createElement('div');
          div.textContent = item;
          div.className = 'autocomplete-item';
          div.addEventListener('click', () => {
            inputElem.value = item;
            listElem.innerHTML = '';
            listElem.style.display = 'none';
          });
          listElem.appendChild(div);
        });
        listElem.style.display = matches.length > 0 ? 'block' : 'none';
      }

      // Input fields and suggestion containers
      const startInput = document.getElementById('start-code');
      const endInput = document.getElementById('end-code');
      const startNameInput = document.getElementById('start-name');
      const endNameInput = document.getElementById('end-name');
      const docInput = document.getElementById('document-code');
      const startSuggestions = document.getElementById('start-code-suggestions');
      const endSuggestions = document.getElementById('end-code-suggestions');
      const startNameSuggestions = document.getElementById('start-name-suggestions');
      const endNameSuggestions = document.getElementById('end-name-suggestions');
      const docSuggestions = document.getElementById('document-code-suggestions');

      startInput.addEventListener('input', () => showSuggestions(startInput, startSuggestions, uniqueCodes));
      endInput.addEventListener('input', () => showSuggestions(endInput, endSuggestions, uniqueCodes));
      startNameInput.addEventListener('input', () => showSuggestions(startNameInput, startNameSuggestions, uniqueNames));
      endNameInput.addEventListener('input', () => showSuggestions(endNameInput, endNameSuggestions, uniqueNames));
      docInput.addEventListener('input', () => showSuggestions(docInput, docSuggestions, uniqueDocs));
      docInput.addEventListener('focus', () => {
        showSuggestions(docInput, docSuggestions, uniqueDocs, true);
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('.autocomplete')) {
          startSuggestions.innerHTML = '';
          startSuggestions.style.display = 'none';
          endSuggestions.innerHTML = '';
          endSuggestions.style.display = 'none';
          startNameSuggestions.innerHTML = '';
          startNameSuggestions.style.display = 'none';
          endNameSuggestions.innerHTML = '';
          endNameSuggestions.style.display = 'none';
          docSuggestions.innerHTML = '';
          docSuggestions.style.display = 'none';
        }
      });
    });

    // Calendar support functions
    function buildEventsMap(data) {
      const events = {};
      data.forEach(item => {
        const datePart = item.receiveDate.split(' ')[0];
        const [bYear, month, day] = datePart.split('-');
        const gYear = parseInt(bYear, 10) - 543;
        const key = `${gYear}-${month}-${day}`;
        if (!events[key]) {
          events[key] = [];
        }
        events[key].push(item);
      });
      return events;
    }

    const thaiMonths = ['มกราคม','กุมภาพันธ์','มีนาคม','เมษายน','พฤษภาคม','มิถุนายน','กรกฎาคม','สิงหาคม','กันยายน','ตุลาคม','พฤศจิกายน','ธันวาคม'];
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    const eventsMap = buildEventsMap(sheetData);

    function renderCalendar() {
      const calendarBody = document.getElementById('calendar-body');
      calendarBody.innerHTML = '';
      const firstDay = new Date(currentYear, currentMonth, 1);
      const startingDay = firstDay.getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      const monthYearTitle = document.getElementById('month-year-title');
      const buddhistYear = currentYear + 543;
      monthYearTitle.textContent = `${thaiMonths[currentMonth]} ${buddhistYear}`;

      let date = 1;
      for (let i = 0; i < 6; i++) {
        const row = document.createElement('tr');
        for (let j = 0; j < 7; j++) {
          const cell = document.createElement('td');
          if (i === 0 && j < startingDay) {
            cell.textContent = '';
          } else if (date > daysInMonth) {
            cell.textContent = '';
          } else {
            const dayNumber = document.createElement('div');
            dayNumber.className = 'calendar-day-number';
            dayNumber.textContent = date;
            cell.appendChild(dayNumber);
            const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
            if (eventsMap[dateKey]) {
              eventsMap[dateKey].forEach(evt => {
                const eventElem = document.createElement('a');
                eventElem.className = 'calendar-event';
                eventElem.href = '#';
                eventElem.textContent = `${evt.productCode} (${evt.quantity})`;
                eventElem.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  showEventDetails(dateKey);
                });
                cell.appendChild(eventElem);
              });
            }
            cell.addEventListener('click', () => {
              showEventDetails(dateKey);
            });
            date++;
          }
          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
        if (date > daysInMonth) break;
      }
    }

    function showEventDetails(dateKey) {
      const eventsList = document.getElementById('events-list');
      eventsList.innerHTML = '';
      if (eventsMap[dateKey]) {
        const [year, month, day] = dateKey.split('-');
        const buddhistYear = parseInt(year, 10) + 543;
        const heading = document.createElement('h3');
        heading.textContent = `รายการรับสินค้าวันที่ ${parseInt(day, 10)}/${month}/${buddhistYear}`;
        eventsList.appendChild(heading);
        const list = document.createElement('ul');
        eventsMap[dateKey].forEach(evt => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>รหัสสินค้า:</strong> ${evt.productCode} <br> <strong>ชื่อสินค้า:</strong> ${evt.productName} <br> <strong>เลขที่เอกสาร:</strong> ${evt.documentCode} <br> <strong>จำนวน:</strong> ${evt.quantity}`;
          list.appendChild(li);
        });
        eventsList.appendChild(list);
      } else {
        eventsList.textContent = 'ไม่มีข้อมูลสินค้าที่รับในวันนี้';
      }
    }

    function prevMonth() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    }

    function nextMonth() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }

    // Reorder point calculation
    const purchaseData = [
      { productCode: 'CAS-022003', productName: 'Copper Washer BSP3/8 #022003', netStock: 4, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-022105', productName: 'Copper Washer M18x1.5 #022105', netStock: 6, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-032001', productName: 'Bonded Washer BSP 1/8 #032001', netStock: 2, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-032002', productName: 'Bonded Washer BSP 1/4 #032002', netStock: 67, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-032003', productName: 'Bonded Washer BSP 3/8 #032003', netStock: 0, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-032004', productName: 'Bonded Washer BSP 1/2 #032004', netStock: 4, sales12: 4, bills12: 1, customers12: 1 },
      { productCode: 'CAS-100104', productName: 'Ring 6 MM # 100104 (L)', netStock: 8, sales12: 80, bills12: 2, customers12: 1 },
      { productCode: 'CAS-100105', productName: 'Ring 8 MM # 100105 (L)', netStock: 70, sales12: 132, bills12: 4, customers12: 4 },
      { productCode: 'CAS-100106', productName: 'Ring 10 MM # 100106 (L)', netStock: 203, sales12: 245, bills12: 11, customers12: 5 },
      { productCode: 'CAS-100107', productName: 'Ring 12 MM # 100107 (L)', netStock: 485, sales12: 1812, bills12: 14, customers12: 5 },
      { productCode: 'CAS-100108', productName: 'Ring 15 MM # 100108 (L)', netStock: 456, sales12: 205, bills12: 16, customers12: 4 },
      { productCode: 'CAS-100109', productName: 'Ring 18 MM # 100109 (L)', netStock: 138, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-100110', productName: 'Ring 22 MM # 100110 (L)', netStock: 78, sales12: 87, bills12: 11, customers12: 1 },
      { productCode: 'CAS-100119', productName: 'Ring 16 MM # 100119 (S)', netStock: 68, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-100120', productName: 'Ring 20 MM # 100120 (S)', netStock: 133, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-100121', productName: 'Ring 25 MM # 100121 (S)', netStock: 51, sales12: 20, bills12: 1, customers12: 1 },
      { productCode: 'CAS-100204', productName: 'Nut 6 MM # 100204 (L)', netStock: 171, sales12: 80, bills12: 1, customers12: 1 },
      { productCode: 'CAS-100205', productName: 'Nut 8 MM # 100205 (L)', netStock: 186, sales12: 100, bills12: 1, customers12: 1 },
      { productCode: 'CAS-100206', productName: 'Nut 10 MM # 100206 (L)', netStock: 202, sales12: 180, bills12: 8, customers12: 3 },
      { productCode: 'CAS-100207', productName: 'Nut 12 MM # 100207 (L)', netStock: 113, sales12: 1530, bills12: 8, customers12: 2 },
      { productCode: 'CAS-100208', productName: 'Nut 15 MM # 100208 (L)', netStock: 489, sales12: 152, bills12: 11, customers12: 1 },
      { productCode: 'CAS-100209', productName: 'Nut 18 MM # 100209 (L)', netStock: 142, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-100210', productName: 'Nut 22 MM # 100210 (L)', netStock: 93, sales12: 87, bills12: 11, customers12: 1 },
      { productCode: 'CAS-100219', productName: 'Nut 16 MM # 100219 (S)', netStock: 139, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-100220', productName: 'Nut 20 MM # 100220 (S)', netStock: 78, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-100221', productName: 'Nut 25 MM # 100221 (S)', netStock: 64, sales12: 0, bills12: 0, customers12: 0 },
      { productCode: 'CAS-100506', productName: 'Straight Connector 10-1/4 BSP # 100506 (L)', netStock: 99, sales12: 7, bills12: 2, customers12: 2 },
      { productCode: 'CAS-100507', productName: 'Straight Connector 12-3/8 BSP # 100507 (L)', netStock: 106, sales12: 52, bills12: 4, customers12: 2 }
    ];

    function calculateReorderList() {
      const list = [];
      purchaseData.forEach(item => {
        let effectiveSales = item.sales12;
        if (item.bills12 === 1 && item.customers12 === 1) {
          effectiveSales = 0;
        }
        const halfSales = effectiveSales / 2;
        const reorderQty = Math.ceil(halfSales - item.netStock);
        if (reorderQty > 0) {
          list.push({
            ...item,
            reorderQty
          });
        }
      });
      return list;
    }

    function renderReorderTable() {
      const container = document.getElementById('order-result');
      if (!container) return;
      const list = calculateReorderList();
      if (list.length === 0) {
        container.innerHTML = '<p>ไม่มีสินค้าที่ควรสั่งซื้อ</p>';
        return;
      }
      let html = '<table class="result-table"><thead><tr><th>#</th><th>รหัสสินค้า</th><th>ชื่อสินค้า</th><th>สุทธิในสต็อก</th><th>ขาย 12 เดือน</th><th>จำนวนที่ควรสั่งซื้อ</th></tr></thead><tbody>';
      list.forEach((item, idx) => {
        html += `<tr>` +
                `<td>${idx + 1}</td>` +
                `<td>${item.productCode}</td>` +
                `<td>${item.productName}</td>` +
                `<td>${item.netStock}</td>` +
                `<td>${item.sales12}</td>` +
                `<td>${item.reorderQty}</td>` +
                `</tr>`;
      });
      html += '</tbody></table>';
      container.innerHTML = html;
    }

    // Main tab switching
    window.addEventListener('DOMContentLoaded', () => {
      const mainSearchTab = document.getElementById('main-search-tab');
      const mainOrderTab = document.getElementById('main-order-tab');
      const searchCalendarContainer = document.getElementById('search-calendar-container');
      const orderSection = document.getElementById('order-section');
      if (mainSearchTab && mainOrderTab) {
        mainSearchTab.addEventListener('click', () => {
          mainSearchTab.classList.add('active');
          mainOrderTab.classList.remove('active');
          if (searchCalendarContainer) searchCalendarContainer.style.display = 'block';
          if (orderSection) orderSection.style.display = 'none';
        });
        mainOrderTab.addEventListener('click', () => {
          mainOrderTab.classList.add('active');
          mainSearchTab.classList.remove('active');
          if (searchCalendarContainer) searchCalendarContainer.style.display = 'none';
          if (orderSection) orderSection.style.display = 'block';
          renderReorderTable();
        });
      }
    });

    // Search and calendar tab switching
    window.addEventListener('DOMContentLoaded', () => {
      const searchTab = document.getElementById('search-tab');
      const calendarTab = document.getElementById('calendar-tab');
      const searchSection = document.getElementById('search-section');
      const calendarSection = document.getElementById('calendar-section');
      searchTab.addEventListener('click', () => {
        searchTab.classList.add('active');
        calendarTab.classList.remove('active');
        searchSection.style.display = 'block';
        calendarSection.style.display = 'none';
      });
      calendarTab.addEventListener('click', () => {
        calendarTab.classList.add('active');
        searchTab.classList.remove('active');
        searchSection.style.display = 'none';
        calendarSection.style.display = 'block';
        renderCalendar();
      });
      document.getElementById('prev-month').addEventListener('click', prevMonth);
      document.getElementById('next-month').addEventListener('click', nextMonth);
    });
  </script>
</body>
</html>
